---
import { getCollection, getEntryBySlug } from 'astro:content';
import Markdown from 'astro/components/Markdown.astro'; // ✅ WAJIB: ini yang kurang sebelumnya

import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Navigation from '../../components/Navigation.astro';
import CategorySidebar from '../../components/CategorySidebar.astro';
import Footer from '../../components/Footer.astro';

// ✅ Wajib export ini untuk Netlify bisa bangun route dinamis
export async function getStaticPaths() {
  const posts = await getCollection('paket-tour');
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug('paket-tour', slug);

if (!post) {
  throw new Error(`Paket tour dengan slug '${slug}' tidak ditemukan.`);
}

const { title, description, pubDate, author } = post.data;
---

<BaseLayout {title} {description}>
  <Header />
  <Navigation />

  <main class="main-content">
    <CategorySidebar />

    <article class="seasonal" style="max-width:800px; margin:0 auto;">
      <h1>{title}</h1>
      <p style="color:#777; font-size:0.95rem;">
        Dipublikasikan: {new Date(pubDate).toLocaleDateString('id-ID')} · Penulis: {author}
      </p>
      <div style="margin-top:1.5rem;">
        <Markdown content={post.body} />
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>
